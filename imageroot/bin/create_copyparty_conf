#!/usr/bin/env python3

import os

import agent
from jinja2 import Environment, FileSystemLoader, select_autoescape

files = ["config/copyparty.conf"]
for file in files:
    try:
        os.remove(file)
    except FileNotFoundError:
        pass

env = Environment(
    loader=FileSystemLoader(os.getenv("AGENT_INSTALL_DIR") + "/templates"),
    autoescape=select_autoescape(),
    keep_trailing_newline=True,
)
username = (
    agent.read_envfile("secrets.env")["COPYPARTY_USERNAME"]
    if os.path.exists("secrets.env")
    else None
)
password = (
    agent.read_envfile("secrets.env")["COPYPARTY_PASSWORD"]
    if os.path.exists("secrets.env")
    else None
)
properties = {
    "username": username,
    "password": password,
}

template = env.get_template("copyparty.conf")
output = template.render(properties)
with open("config/copyparty.conf", "w") as file:
    file.write(output)
